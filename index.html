<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="index.css">   
</head>
<body>
    <div class="nem-div">
        <h1>Welcome to your Account.</h1>
        <p>Please log in to NemID to see your information</p>
        <iframe height="225px" width="200px" frameborder="0" src="http://80.210.70.4:3333/easyid-form.php"></iframe>
        <script>
           
            if (window.addEventListener) {
              window.addEventListener("message", onMessage, false);        
            } 
            else if (window.attachEvent) {
                window.attachEvent("onmessage", onMessage, false);
            }
           
            function onMessage(event) {
                // Check sender origin to be trusted
                if (event.origin !== "http://80.210.70.4:3333"){
                  console.log('not allowed')
                  return;
                } 
           
                var data = event.data;
           
                if (typeof(window[data.func]) == "function") {
                    window[data.func].call(null, data.message);
                }
            }
           
          // Function to be called from iframe
          function parentFunc(message) {
            const http = new XMLHttpRequest()
            http.open('POST', 'http://localhost:8080/token', true)
            http.setRequestHeader('Content-type', 'application/json;charset=UTF-8')
            let token = {
                token: message
            }
            http.send(JSON.stringify(token)) 
            http.onload = function() {
                var jsonSkatBalance = http.responseText
                renderSkat(jsonSkatBalance)

            } 


            const httpPy = new XMLHttpRequest()
                httpPy.open('POST', 'http://localhost:5000/token', true)
                httpPy.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
                // httpPy.setRequestHeader('content-type', 'application/xml');
                let token1 = message
                httpPy.send("name=" + token1) 
                httpPy.onload = function() {
                    renderBank(httpPy.responseText)

                }  

            }  

            function renderSkat(userInformationJSON){
            let jsonDiv = document.getElementById("user-information-json")
                jsonDiv.innerHTML = userInformationJSON;
            }

            function renderBank(userInformationXML){

                let xmlDiv = document.getElementById("user-information-xml")
                xmlDiv.innerHTML = userInformationXML;
           
            }
          </script>
          
    </div>

    <div id="user-information-json">

    </div>

    <div id="user-information-xml">

    </div>

</body>
</html>